(()=>{"use strict";(()=>{const{compressX64:t,decompressX64:e}=shapez,{SerializerInternal:n}=shapez,i=">>>",a="<<<",o=["uncolored","blue","green","cyan","red","purple","yellow","white"],r=["C","R","W","S"];class s{static packEntities(e){let n=e.reduce(((t,e)=>[Math.min(t[0],e.components.StaticMapEntity.origin.x),Math.min(t[1],e.components.StaticMapEntity.origin.y)]),[1/0,1/0]),i=[];e.forEach((t=>{let e=t.components.StaticMapEntity,a=e.origin.x-n[0],o=e.origin.y-n[1],r=a/16|0,l=o/16|0,c=i.find((t=>t[0][0]===r&&t[0][1]===l));c||(c=[[r,l]],i.push(c));let d=[a%16<<4|o%16,e.rotation/90<<4|e.originalRotation/90,e.code],p=[];31===e.code&&(p=s.writeValue(t.components.ConstantSignal.signal.data,t.components.ConstantSignal.signal.$)),c.push([...d,...p])})),i.forEach((t=>t[0].push(t.length-1)));let o=String.fromCharCode(...i.flat(1/0)),r=t(o),l=btoa(o);return r.length<l.length?">>>1"+r+a:">>>0"+l+a}static unpackEntities(t,o){if(!o.startsWith(i)||!o.endsWith(a))throw"Not a blueprint string";let r=o.substring(i.length+1,o.length-a.length);switch(o.charAt(i.length)){case"0":r=atob(r);break;case"1":r=e(r);break;default:throw"Unknown blueprint format"}let l=[0,0],c=[];for(let t=0;t<r.length;){let e=r.charCodeAt(t++),n=r.charCodeAt(t++),i=r.charCodeAt(t++);for(let a=0;a<i;a++){let i=r.charCodeAt(t++),a=r.charCodeAt(t++),o=r.charCodeAt(t++),d={uid:0,components:{StaticMapEntity:{origin:{x:(i>>4&15)+16*e,y:(15&i)+16*n},rotation:90*(a>>4&15),originalRotation:90*(15&a),code:o}}};31===o&&([d.components.ConstantSignal,t]=s.readValue(r,t)),l=[Math.max(l[0],d.components.StaticMapEntity.origin.x),Math.max(l[1],d.components.StaticMapEntity.origin.y)],c.push(d)}}return c.map((e=>{e.components.StaticMapEntity.origin.x-=l[0]/2|0,e.components.StaticMapEntity.origin.y-=l[1]/2|0;const i=(new n).deserializeEntityNoPlace(t,e);if("string"==typeof i)throw new Error(i);return i}))}static writeString(t){return[t.length,...t]}static readString(t){return""}static writeValue(t,e){if("boolean_item"===e)return[1&t];if("color"===e)return[7&o.indexOf(t)|8];if("shape"===e){t=(t=t.replaceAll(":","")).padEnd(t.length>16?32:16,"-").match(/(.{2})/g);let e=[];for(let n=0;n<t.length;n++)e[Math.floor(n/8)]=e[Math.floor(n/8)]<<1|"--"!==t[n];t=t.filter((t=>"--"!==t));let n=[],i=0;for(let e=0;e<t.length;e++){const a=r.indexOf(t[e].charAt(0)),s=o.findIndex((n=>n.startsWith(t[e].charAt(1))))<<2|a,l=i%8-3;n[Math.floor(i/8)]|=l<0?s<<-l:s>>l,l>0&&(n[Math.floor(i/8)+1]|=s<<8-l&255),i+=5}return[...e,...n]}}static readValue(t,e){let n=t.charCodeAt(e++);if(0==(248&n))return[{$:"boolean_item",data:n},e];if(8==(248&n))return[{$:"color",data:o[7&n]},e];n<<=8,3840&n&&(n+=t.charCodeAt(e++));const i=new Array(16);let a=0,s=0;for(let l=0;l<16;l++)if(n>>15-l&1){s<5&&(a|=t.charCodeAt(e++)<<4-s,s+=8);let n=a>>7&31;a<<=5,s-=5;let c=r[3&n],d=o[n>>2&7].charAt(0);i[l]=c+d}else i[l]="--";let l=[];for(let t=0;t<16;t+=4){let e=i.slice(t,t+4).join("");"--------"!==e&&l.push(e)}return[{signal:{$:"shape",data:l.join(":")}},e]}}const l=JSON.parse('{"id":"bp-string","name":"Blueprint strings","author":"FatcatX and SkimnerPhi","version":"1.3.0","description":"Generate a sharable string in the system clipboard when you copy and paste blueprints.","website":"https://github.com/garretsimpson/shapez-mods","minimumGameVersion":">=1.5.0","doesNotAffectSavegame":true,"entry":"./index.js"}'),{Vector:c}=shapez,{getBuildingDataFromCode:d}=shapez,{HUDBlueprintPlacer:p}=shapez,{Mod:h}=shapez,{Blueprint:u}=shapez,{SerializerInternal:g}=shapez,m=({$old:t})=>({createBlueprintFromBuildings(...e){t.createBlueprintFromBuildings.call(this,...e),y.copyToClipboard(this.currentBlueprint.get())},pasteBlueprint(...e){const n=y.pasteFromClipboard(this.root);this.lastBlueprintUsed=n||this.lastBlueprintUsed,t.pasteBlueprint.call(this,...e)}}),f=()=>({deserializeEntityNoPlace(t,e){console.debug("##### ds-enitiy:",e);const n=e.components.StaticMapEntity;window.assert(n,"entity has no static data");const i=n.code,a=d(i),o=a.metaInstance.createEntity({root:t,origin:c.fromSerializedObject(n.origin),rotation:n.rotation,originalRotation:n.originalRotation,rotationVariant:a.rotationVariant,variant:a.variant});return o.uid=e.uid,this.deserializeComponents(t,o,e.components)||o}});class y extends h{static serializeOld(t){let e=(new g).serializeEntityArray(t);for(let t of e)delete t.uid,delete t.components.WiredPins,delete t.components.ItemEjector,delete t.components.ItemProcessor,delete t.components.UndergroundBelt;return e}static serialize(t){const e=(new g).serializeEntityArray(t);return console.debug("##### data out:",e),s.packEntities(e)}static deserialize(t,e){console.debug("##### data in:",e);const n=s.unpackEntities(t,e);return new u(n)}static async copyToClipboard(t){const e=y.serialize(t.entities);console.debug("Copy to clipboard:",e);try{await navigator.clipboard.writeText(e),console.debug("Copied blueprint to clipboard")}catch(t){console.error("Copy to clipboard failed:",t.message)}}static pasteFromClipboard(t){let e;try{const n=y.getClipboard().trim();console.debug("Received data from clipboard:",n),e=y.deserialize(t,n)}catch(t){console.error("Paste from clipboard failed:",t)}return e}static getClipboard(){var t=document.createElement("div");t.contentEditable=!0;var e=document.activeElement.appendChild(t).parentNode;t.focus(),document.execCommand("Paste",null,null);var n=t.innerText;return e.removeChild(t),n}init(){console.debug("##### Init mod:",l.id),this.modInterface.extendClass(g,f),this.modInterface.extendClass(p,m)}}var b,C;b=y,delete(C=l).entry,window.$shapez_registerMod(b,C)})()})();